# B"H


I have a very important task for you. 

## Task Intro

Review `.sandbox/deep-research-01/02-add-context.ipynb` in-depth.
Review `/home/izzy/repos/x-large-files/x-large-files-p5-tag-intelligence/deep-research-01/raw-tag-values.json` in-depth!
Review https://docs.claude.com/en/docs/build-with-claude/batch-processing in-depth!

## Your Task

I have some sample Python code that I want you to finish up and add to `.sandbox/deep-research-01/02-add-context.ipynb` as cells etc.  

Here is the sample Python code:

PYTHON SAMPLE CODE - BEGIN

```py

import os
from anthropic import AnthropicVertex


client = AnthropicVertex(
    project_id=os.getenv("ANTHROPIC_VERTEX_PROJECT_ID"),
    region=os.getenv("CLOUD_ML_REGION")
)




PROMPT_TEMPLATE = '''
You will analyze AWS resource tag data to extract and explain the meaning of components within a specific tag value. Your goal is to provide clear explanations only when you have confident evidence from the available data.

Here is the AWS resource data you need to analyze:

<aws_resource_data_formatted_str>
{aws_resource_data_formatted_str}
</aws_resource_data_formatted_str>

## Your Task

Analyze the SELECTED_TAG_VAL from the data above and identify what its components likely mean. You can draw evidence from these fields:
- COMPANY_NAME
- SELECTED_TAG_KEY  
- ALL_TAGS (JSON containing all tags for this resource)
- ALL_TAGS_LENGTH
- PROJECT_ID
- RESOURCE_TYPE_NAME
- RESOURCE_ID

## Analysis Guidelines

**Include components when you have:**
- Clear matches between components and values in the ALL_TAGS field
- Self-evident meanings (e.g., "s3bucket" clearly refers to AWS S3 Bucket)
- Obvious meanings from standard AWS or technical naming conventions
- Strong contextual clues from RESOURCE_TYPE_NAME, RESOURCE_ID, or other fields

**Skip components when:**
- The meaning is unclear or ambiguous
- You would need to speculate without supporting evidence
- No clear connections exist in the available data

**Expanding terse terms or acronyms:**
- When you are confident about the meaning of abbreviated terms, expand them in parentheses
- For example: "deployCF" becomes "deployCF (CloudFormation-based deployment)"
- Only do this when you have strong evidence for the expansion

## Instructions

First, wrap your analysis in <analysis> tags inside your thinking block. In this section:

1. Write out the SELECTED_TAG_VAL and break it down into individual components (typically separated by dashes or other delimiters)
2. Systematically extract and list all potentially relevant values from each available data field: COMPANY_NAME, ALL_TAGS, PROJECT_ID, RESOURCE_TYPE_NAME, RESOURCE_ID
3. Go through each component one by one and check it against the extracted values to find matches or clear connections - document what you find for each component
4. For each component, make an explicit decision about whether you have sufficient evidence to confidently categorize it
5. Consider whether any components are terse terms or acronyms that you can confidently expand based on the available evidence
6. Make your final decision about which components to include in your output

It's OK for this section to be quite long, as thorough systematic checking is important for accuracy.

Then provide your final answer using this exact format:

```
AWS Resource tag value: '[the actual tag value]'

Facts:
- [Category]: [component]
- [Category]: [component (expansion if applicable)]
- [Category]: [component]
```

Use descriptive category names such as:
- Project/System
- Resource Type  
- Service/Domain
- Cost-Center/Business-Unit
- Environment
- Team
- Application
- Deployment Method

Example output structure:
```
AWS Resource tag value: 'example-app-prod-v2'

Facts:
- Application: example-app
- Environment: prod (production environment)  
- Version: v2
```

Only include facts for components you can confidently explain based on clear evidence from the data. Your final output should consist only of the formatted answer and should not duplicate or rehash any of the systematic analysis you performed in the thinking block.
'''

aws_resource_data_formatted_str = '''
{
    "COMPANY_NAME":"Infor",
    "SELECTED_TAG_KEY":"faro:deployment",
    "SELECTED_TAG_VAL":"EZRMSLOS01",
    "ALL_TAGS":"{
        "Edition": "EE",
        "InforCost": "DOPLB-CLD",
        "Name": "EZRMSLOS01",
        "Owner": "CloudOps-Hospitality-EMEA-Support@infor.com",
        "Product": "ezrms",
        "RegFinancialOwner": "durga.dash@infor.com",
        "RegTechnicalOwner": "ladislav.pecho@infor.com",
        "Service": "ezrms:db",
        "Team": "EZRMS",
        "aws:cloudformation:logical-id": "EC2Instance",
        "aws:cloudformation:stack-id": "arn:aws:cloudformation:eu-central-1:447531469113:stack/EZRMSLOS01/e942f070-6f27-11ee-8f3d-06871ebdd8aa",
        "aws:cloudformation:stack-name": "EZRMSLOS01",
        "faro:deployment": "EZRMSLOS01",
        "map-migrated": "d-server-03cwerj0uu8s9j"
    }",
    "ALL_TAGS_LENGTH":556,
    "PROJECT_ID":447531469113,
    "RESOURCE_TYPE_NAME":"AWSEC2Instance",
    "RESOURCE_ID":"arn:aws:ec2:eu-central-1:447531469113:instance/i-09d800de2fc792970"
  }
'''

prompt = PROMPT_TEMPLATE.format(aws_resource_data_formatted_str=aws_resource_data_formatted_str)

message = client.messages.create(
    model="claude-haiku-4-5@20251001",
    max_tokens=5000,
    temperature=0.5,
    messages=[
        {
            "role": "user",
            "content": [
                {
                    "type": "text",
                    "text": prompt
                }
            ]
        }
    ]
)

print(message.content)
```

PYTHON SAMPLE CODE - END


### Your Tasks in Details

1. Do NOT change the PROMPT_TEMPLATE - that has to stay the same.
2. Loop each record in RAW_TAG_VALUES_JSON_FILE (this is the same  `/home/izzy/repos/x-large-files/x-large-files-p5-tag-intelligence/deep-research-01/raw-tag-values.json` file mentioned above); for each record convert the entire record into a clean JSON str (see for example `aws_resource_data_formatted_str` above.
3. I need you tweak the code to pass all the records' aws_resource_data_formatted_str's to the Claude Message Batches API (https://docs.claude.com/en/docs/build-with-claude/batch-processing)


## Important Note

After making the changes to `.sandbox/deep-research-01/02-add-context.ipynb` make sure the changes work by running all the cells! 

## Final Notes

Use your best judgement on this task! Be rational, use common sense!

Keep things super simple! Keep thing as simple as possible! Do NOT over-engineer it! no fluff! 
      
ultrathink on this task! This is a super crucial task!